<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Car Racing Game</title>
    
    <!-- === STEP 1: APNA AD NETWORK SCRIPT YAHAN UNCOMMENT KARKE ID DAALEIN === -->
    
    <!-- AdinPlay Script (Jab AdinPlay use karein to ise uncomment karein) -->
    <!-- <script type="text/javascript" src="https://api.adinplay.com/libs/aiptag/pub/YOUR_ADINPLAY_TAG_ID/tag.min.js"></script> -->
    
    <!-- ironSource Script (Jab ironSource use karein to ise uncomment karein) -->
    <!-- <script>
        (function (d, s, id, c) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s);
            js.id = id;
            js.src = "https://static.is.com/sdp/sdk/js/loader.js";
            js.onload = function () {
                IS_LOADER.init(c);
            };
            fjs.parentNode.insertBefore(js, fjs);
        })(document, "script", "is-loader", "YOUR_IRONSOURCE_APP_KEY");
    </script> -->

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #111; overflow: hidden; font-family: 'Arial', sans-serif; }
        #gameContainer { position: relative; width: 100vw; height: 100vh; -webkit-tap-highlight-color: transparent; overflow: hidden; }
        canvas { width: 100%; height: 100%; display: block; }
        
        #coinDisplay {
            position: absolute; top: 2vh; left: 3vw;
            background-color: rgba(0,0,0,0.6); color: #FFD700;
            padding: 1.5vh 3vw; border-radius: 50px;
            font-size: 5vmin; font-weight: bold;
            display: flex; align-items: center; gap: 10px;
            z-index: 11; border: 2px solid #FFD700;
        }
        #coinDisplay img { width: 6vmin; height: 6vmin; max-width: 30px; max-height: 30px; }
        #startScreen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.4); color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; }
        #startScreen h1 { font-size: 10vw; margin-bottom: 20px; text-shadow: 3px 3px 5px #000; }
        #difficultySelector { display: flex; flex-direction: column; gap: 20px; align-items: center; }
        
        /* === NEW: Rewarded Ad Button Style === */
        #rewardButton {
            background-color: #FFC107; color: black;
            border: 2px solid white; border-radius: 10px;
            padding: 10px 20px; margin-top: 25px;
            font-size: 4vmin; font-weight: bold; cursor: pointer;
            display: flex; align-items: center; gap: 10px;
        }
        #rewardButton img { width: 24px; height: 24px; }

        /* (Baki CSS same hai) */
        .difficulty-btn { cursor: pointer; border: none; background-color: transparent; width: 250px; max-width: 60vw; height: 80px; background-size: contain; background-repeat: no-repeat; background-position: center; transition: transform 0.2s; } .difficulty-btn:active { transform: scale(0.95); } #easyButton { background-image: url('easy.png'); } #mediumButton { background-image: url('medium.png'); } #hardButton { background-image: url('hard.png'); } .control-btn { position: absolute; bottom: 12vh; width: 15vmin; height: 15vmin; max-width: 80px; max-height: 80px; background-color: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 255, 255, 0.7); border-radius: 50%; color: white; font-size: 8vmin; font-weight: bold; display: flex; justify-content: center; align-items: center; cursor: pointer; user-select: none; z-index: 10; } .control-btn.positioning { border: 3px dashed #FFD700; animation: pulse-border 1s infinite; } @keyframes pulse-border { 0% { border-color: #FFD700; } 50% { border-color: #fff; } 100% { border-color: #FFD700; } } .control-btn:active { background-color: rgba(255, 255, 255, 0.3); } #leftButton { left: 5vw; } #rightButton { right: 5vw; } #settingsButton { position: absolute; top: 2vh; right: 3vw; width: 12vmin; height: 12vmin; max-width: 50px; max-height: 50px; background: url('settings.png') no-repeat center center / 70% 70%, rgba(0,0,0,0.5); border-radius: 50%; border: 2px solid white; z-index: 11; cursor: pointer; } .modal { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.85); color: white; z-index: 20; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; } .modal h2 { font-size: 8vw; margin-bottom: 20px; } .modal-content { display: flex; flex-direction: column; gap: 20px; width: 90%; max-width: 450px; max-height: 85vh; overflow-y: auto; padding: 10px; } #carSelection { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; } .car-option { background-color: rgba(255, 255, 255, 0.1); border: 2px solid #4CAF50; border-radius: 10px; padding: 10px; text-align: center; cursor: pointer; transition: transform 0.2s, background-color 0.2s; display: flex; flex-direction: column; justify-content: space-between; align-items: center; } .car-option.selected { border-color: #FFD700; background-color: rgba(76, 175, 80, 0.5); transform: scale(1.05); } .car-option img { width: 80px; height: auto; max-width: 100%; } .car-option p { margin-top: 10px; font-weight: bold; } .car-option.locked { cursor: default; background-color: rgba(0,0,0,0.5); border-color: #555; position: relative; } .car-option.locked::after { content: 'ðŸ”’'; position: absolute; top: 5px; right: 5px; font-size: 24px; text-shadow: 1px 1px 2px black; } .buy-btn { background-color: #FFC107; color: black; border: none; border-radius: 5px; padding: 8px 12px; margin-top: 10px; cursor: pointer; font-weight: bold; width: 100%; } .buy-btn:disabled { background-color: #777; cursor: not-allowed; color: #ccc; } .price-tag { display: flex; align-items: center; justify-content: center; gap: 5px; font-size: 16px; font-weight: bold; color: #FFD700; } .price-tag img { width: 18px; height: 18px; } .modal-button { margin-top: 10px; padding: 2vh 4vw; font-size: 4vw; color: white; border: none; border-radius: 10px; cursor: pointer; } #closeShopButton { background-color: #f44336; } #openSettingsButton { background-color: #2196F3; } #backToMenuButton { background-color: #f44336; } .settings-option { display: flex; flex-direction: column; align-items: center; gap: 10px; } .settings-option label { font-size: 4vw; } input[type="range"] { width: 100%; } #positionControlsButton { background-color: #FFC107; color: black; } #savePositionsButton { background-color: #4CAF50; display: none; } #magnetTimer { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); background-color: rgba(0,0,0,0.6); color: white; padding: 1.5vh 3vw; border-radius: 20px; font-size: 4vmin; font-weight: bold; display: flex; align-items: center; gap: 10px; z-index: 5; } #magnetTimer img { width: 30px; height: 30px; } .hidden { display: none !important; } .game-object { position: absolute; filter: drop-shadow(4px 4px 3px rgba(0,0,0,0.5)); } #playerCarElement { z-index: 4; } #permissionScreen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #000; color: white; display: flex; justify-content: center; align-items: center; z-index: 30; cursor: pointer; text-align: center;}
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <div id="gameObjectContainer"><img id="playerCarElement" class="game-object hidden"></div>
        <div id="popupContainer"></div>
        <div id="leftButton" class="control-btn hidden">â—€</div>
        <div id="rightButton" class="control-btn hidden">â–¶</div>

        <div id="startScreen">
            <div id="coinDisplay" class="hidden"> <img src="coin.gif" alt="Coin"> <span id="totalCoinsDisplay">0</span> </div>
            <h1>Car Racing</h1>
            <div id="difficultySelector">
                <button id="easyButton" class="difficulty-btn"></button>
                <button id="mediumButton" class="difficulty-btn"></button>
                <button id="hardButton" class="difficulty-btn"></button>
            </div>
            <!-- NEW: Rewarded Ad Button Added -->
            <button id="rewardButton">
                <img src="coin.gif">
                <span>Get 150 Free Coins</span>
            </button>
            <div id="settingsButton"></div>
        </div>
        
        <div id="shopModal" class="modal hidden"> <div class="modal-content"> <h2>Choose Your Car</h2> <div id="carSelection"></div> <button id="openSettingsButton" class="modal-button">Game Settings</button> <button id="closeShopButton" class="modal-button">Back to Menu</button> </div> </div>
        <div id="settingsModal" class="modal hidden"> <div class="modal-content"> <h2>Settings</h2> <div class="settings-option"> <label for="opacitySlider">Controls Opacity</label> <input type="range" id="opacitySlider" min="0" max="100" value="40"> </div> <button id="positionControlsButton" class="modal-button">Set Control Position</button> <button id="savePositionsButton" class="modal-button">Save Positions</button> <button id="backToMenuButton" class="modal-button">Back to Shop</button> </div> </div>
        <div id="magnetTimer" class="hidden"><img src="magnet.png"><span></span></div>
        <div id="permissionScreen"><h2>Tap to Start</h2></div>
    </div>

    <script>
        // === ADS CONFIGURATION: YAHAN SE ADS CONTROL KAREIN ===
        const ADS_CONFIG = {
            // STEP 2: YAHAN activeNetwork badalkar network switch karein ('adinplay' ya 'ironsource')
            activeNetwork: 'adinplay',
            rewardAmount: 150,

            adinplay: {
                // AdinPlay ke liye alag se ID ki zaroorat nahi hoti, bas upar script tag me daalna hota hai.
            },
            ironsource: {
                // STEP 3: Yahan ironSource se mili App Key daalein
                appKey: "YOUR_IRONSOURCE_APP_KEY", 
                rewardedPlacement: "DefaultRewardedVideo", // Ya jo bhi aapne dashboard me set kiya hai
                interstitialPlacement: "DefaultInterstitial"
            }
        };

        // --- Baki ka Game Config same hai ---
        const CONFIG = { playerCarWidthPercent: 0.11, playerSpeedMultiplier: 0.0216, roadSpeedMultiplier: 0.006, difficulty: { easy: 1.0, medium: 1.1, hard: 1.21 }, obstacleWidthFactor: 0.75, obstacleSpawnInterval: 120, coinSizePercent: 0.15, coinSpawnInterval: 180, magnetSizePercent: 0.1, magnetSpawnInterval: 600, magnetDuration: 360 };
        const cars = [ { name: 'Default Racer', src: 'player_car.png', price: 0, unlocked: true }, { name: 'Blue Thunder', src: 'player_car_2.png', price: 50, unlocked: false }, { name: 'Red Fury', src: 'player_car_3.png', price: 100, unlocked: false }, { name: 'Green Ghost', src: 'player_car_4.png', price: 250, unlocked: false }, { name: 'Yellow Jacket', src: 'player_car_5.png', price: 500, unlocked: false } ];
        
        // --- DOM Elements ---
        const canvas = document.getElementById('gameCanvas'), ctx = canvas.getContext('2d');
        const gameContainer = document.getElementById('gameContainer');
        const startScreen = document.getElementById('startScreen'), coinDisplay = document.getElementById('coinDisplay'), totalCoinsDisplay = document.getElementById('totalCoinsDisplay'), rewardButton = document.getElementById('rewardButton');
        const shopModal = document.getElementById('shopModal'), closeShopButton = document.getElementById('closeShopButton');
        const settingsButton = document.getElementById('settingsButton');
        const settingsModal = document.getElementById('settingsModal'), backToMenuButton = document.getElementById('backToMenuButton');
        const magnetTimerDiv = document.getElementById('magnetTimer');
        const leftButton = document.getElementById('leftButton'), rightButton = document.getElementById('rightButton');
        const permissionScreen = document.getElementById('permissionScreen');
        let gameState = 'menu', score = 0, difficultyMultiplier = 1.0, totalCoins = 0;
        let selectedCarSrc = 'player_car.png';
        let assets = { road: new Image(), hitSound: new Audio(), carSound: new Audio(), collectSound: new Audio(), openingSound: new Audio() };
        const playerCar = { element: document.getElementById('playerCarElement'), x: 0, y: 0, magnetActive: false, magnetTimer: 0 };
        let road = {}, coins = [], obstacles = [], magnets = [];
        let coinSpawnTimer = 0, obstacleSpawnTimer = 0, magnetSpawnTimer = 0;
        let D_DIMS = {};

        // === NEW: ADS LOGIC (Yahan Ads ka Pura System Hai) ===
        
        // Ye function ads ko initialize karega
        function initializeAds() {
            if (ADS_CONFIG.activeNetwork === 'adinplay' && window.aiptag) {
                window.aiptag.cmd.player.push(function() {
                    adplayer = new aip.player({
                        AD_WIDTH: 960, AD_HEIGHT: 540,
                        AD_FULLSCREEN: true,
                        AD_CENTERPLAYER: true,
                        LOADING_TEXT: 'loading advertisement...',
                        PREROLL_ELEM: function(){},
                        AIP_COMPLETE: function () { console.log("AdinPlay Ad Completed"); }
                    });
                });
            } else if (ADS_CONFIG.activeNetwork === 'ironsource' && window.IS_LOADER) {
                // IronSource SDK apne aap initialize ho jaata hai
                console.log("IronSource SDK is ready.");
            }
        }
        
        // Ye function Interstitial (Full Screen) ad dikhayega
        function showInterstitialAd() {
            console.log("Showing Interstitial Ad...");
            if (ADS_CONFIG.activeNetwork === 'adinplay' && window.adplayer) {
                adplayer.startPreRoll();
            } else if (ADS_CONFIG.activeNetwork === 'ironsource' && window.SupersonicRV) {
                SupersonicRV.showInterstitial(ADS_CONFIG.ironsource.interstitialPlacement);
            }
        }
        
        // Ye function Rewarded (Inaam wala) ad dikhayega
        function showRewardedAd() {
            console.log("Showing Rewarded Ad...");
            if (ADS_CONFIG.activeNetwork === 'adinplay' && window.adplayer) {
                 // AdinPlay me Rewarded aur Interstitial ke liye same function use hota hai
                 // Ad complete hone par reward dena padega
                 adplayer.startPreRoll();
                 adplayer.addEventListener("complete", grantReward); 
            } else if (ADS_CONFIG.activeNetwork === 'ironsource' && window.SupersonicRV) {
                SupersonicRV.showRewardedVideo(ADS_CONFIG.ironsource.rewardedPlacement);
                // IronSource reward ke liye alag se event listener use karta hai
                SupersonicRV.setRVCallback({
                    onAdRewarded: function(placementInfo){
                        grantReward();
                    }
                });
            }
        }

        function grantReward() {
            console.log(`Granting reward: ${ADS_CONFIG.rewardAmount} coins.`);
            totalCoins += ADS_CONFIG.rewardAmount;
            updateCoinDisplay();
            saveGameData();
            alert(`You have received ${ADS_CONFIG.rewardAmount} coins!`);
            // Event listener ko hata do taaki baar baar na chale
            if (ADS_CONFIG.activeNetwork === 'adinplay' && window.adplayer) {
                adplayer.removeEventListener("complete", grantReward);
            }
        }

        // --- Game Logic (Baki sab kuch same hai) ---
        function onGameOver() {
            assets.carSound.pause();
            assets.hitSound.currentTime = 0;
            assets.hitSound.play();
            gameState = 'gameOver';

            // Game over hone ke 2 second baad ad dikhao aur fir main menu
            setTimeout(() => {
                showInterstitialAd(); // Ad dikhao
                showStartScreen();    // Main menu par jao
            }, 2000);
        }
        
        // --- init() function me ads ko initialize karna ---
        function init() {
            initializeAds(); // Ads ko initialize karo
            loadGameData();
            loadSettings();
            
            // Reward button ka event listener
            rewardButton.addEventListener('click', showRewardedAd);

            document.getElementById('easyButton').addEventListener('click', () => startGame(CONFIG.difficulty.easy));
            // (Baki init() function same hai)
            document.getElementById('mediumButton').addEventListener('click', () => startGame(CONFIG.difficulty.medium)); document.getElementById('hardButton').addEventListener('click', () => startGame(CONFIG.difficulty.hard)); const handleTouchStart = (e) => e.preventDefault(); ['mousedown', 'touchstart'].forEach(evt => { leftButton.addEventListener(evt, (e) => { handleTouchStart(e); isMovingLeft = true; }); rightButton.addEventListener(evt, (e) => { handleTouchStart(e); isMovingRight = true; }); }); ['mouseup', 'mouseleave', 'touchend'].forEach(evt => { leftButton.addEventListener(evt, () => isMovingLeft = false); rightButton.addEventListener(evt, () => isMovingRight = false); }); permissionScreen.addEventListener('click', () => { permissionScreen.classList.add('hidden'); showStartScreen(); requestAnimationFrame(gameLoop); }, { once: true }); settingsButton.addEventListener('click', () => { startScreen.classList.add('hidden'); populateCarShop(); shopModal.classList.remove('hidden'); }); closeShopButton.addEventListener('click', () => { shopModal.classList.add('hidden'); startScreen.classList.remove('hidden'); }); document.getElementById('openSettingsButton').addEventListener('click', () => { shopModal.classList.add('hidden'); settingsModal.classList.remove('hidden'); }); backToMenuButton.addEventListener('click', () => { settingsModal.classList.add('hidden'); shopModal.classList.remove('hidden'); }); const opacitySlider = document.getElementById('opacitySlider'); opacitySlider.addEventListener('input', (e) => { const opacity = e.target.value / 100; leftButton.style.backgroundColor = `rgba(0, 0, 0, ${opacity})`; rightButton.style.backgroundColor = `rgba(0, 0, 0, ${opacity})`; localStorage.setItem('controlOpacity', e.target.value); }); document.getElementById('positionControlsButton').addEventListener('click', enterPositioningMode); document.getElementById('savePositionsButton').addEventListener('click', exitPositioningMode); window.addEventListener('resize', showStartScreen);
        }

        // --- updateAndCheckObjects() me onGameOver call karna ---
        function update() {
            if (gameState !== 'playing') return;
            // ... (Baki update function same hai, sirf obstacle collision me badlav hai)
            updateAndCheckObjects(obstacles, (obstacle) => {
                if (checkCollision(playerCar, obstacle)) {
                    onGameOver(); // Game Over function ko call karo
                }
            });
            // (Baki update function same hai)
            road.y1 += D_DIMS.baseSpeed; road.y2 += D_DIMS.baseSpeed; if (road.y1 >= canvas.height) road.y1 = road.y2 - canvas.height; if (road.y2 >= canvas.height) road.y2 = road.y1 - canvas.height; if (playerCar.magnetActive) { playerCar.magnetTimer--; magnetTimerDiv.querySelector('span').innerText = `${Math.ceil(playerCar.magnetTimer / 60)}s`; if (playerCar.magnetTimer <= 0) { playerCar.magnetActive = false; magnetTimerDiv.classList.add('hidden'); } } if (isMovingLeft) playerCar.x -= D_DIMS.playerCarSpeed; if (isMovingRight) playerCar.x += D_DIMS.playerCarSpeed; playerCar.x = Math.max(D_DIMS.roadLeftBoundary, Math.min(playerCar.x, D_DIMS.roadRightBoundary - D_DIMS.playerCarWidth)); playerCar.element.style.left = `${playerCar.x}px`; if (++obstacleSpawnTimer > CONFIG.obstacleSpawnInterval) { obstacles.push(createGameObject('obstacle-car', `obstacle${Math.floor(Math.random() * 4) + 1}.png`, D_DIMS.obstacleWidth, D_DIMS.obstacleHeight, D_DIMS.baseSpeed + Math.random() * 2)); obstacleSpawnTimer = 0; } if (++coinSpawnTimer > CONFIG.coinSpawnInterval) { coins.push(createGameObject('coin', 'coin.gif', D_DIMS.coinSize, D_DIMS.coinSize, D_DIMS.baseSpeed)); coinSpawnTimer = 0; } if (++magnetSpawnTimer > CONFIG.magnetSpawnInterval) { magnets.push(createGameObject('magnet-powerup', 'magnet.png', D_DIMS.magnetSize, D_DIMS.magnetSize, D_DIMS.baseSpeed)); magnetSpawnTimer = 0; } updateAndCheckObjects(coins); updateAndCheckObjects(magnets, (magnet) => { if (checkCollision(playerCar, magnet)) { playerCar.magnetActive = true; playerCar.magnetTimer = CONFIG.magnetDuration; magnetTimerDiv.classList.remove('hidden'); return true; } });
        }
        
        // --- Baki sabhi functions bina kisi badlav ke ---
        function updateAndCheckObjects(arr, onCollision) { for (let i = arr.length - 1; i >= 0; i--) { const obj = arr[i]; obj.y += obj.speed || D_DIMS.baseSpeed; if (obj.element.classList.contains('coin') && playerCar.magnetActive) { const dx = (playerCar.x + D_DIMS.playerCarWidth / 2) - (obj.x + obj.width / 2); const dy = (playerCar.y + D_DIMS.playerCarHeight / 2) - (obj.y + obj.height / 2); const distance = Math.sqrt(dx * dx + dy * dy); if (distance < canvas.width * 0.45) { obj.x += dx * 0.1; obj.y += dy * 0.1; } } obj.element.style.top = `${obj.y}px`; obj.element.style.left = `${obj.x}px`; let removed = false; if (obj.element.classList.contains('coin')) { if (checkCollision(playerCar, obj)) { score += 1; totalCoins += 1; updateCoinDisplay(); saveGameData(); assets.collectSound.currentTime = 0; assets.collectSound.play(); createScorePopup(obj.x, obj.y); removed = true; } } else if (onCollision) { removed = onCollision(obj); } if (removed || obj.y > canvas.height) { obj.element.remove(); arr.splice(i, 1); } } }
        function loadAssets(callback) { const assetSources = { road: 'road.jpg', hitSound: 'carhit.mp3', carSound: 'carsound.mp3', collectSound: 'collect.wav', openingSound: 'opening.wav' }; let loaded = 0; const total = Object.keys(assetSources).length; if (total === 0) { callback(); return; } const assetLoaded = () => { loaded++; if (loaded === total) { callback(); } }; const assetFailed = (assetName, src) => { console.error(`Error: Asset '${assetName}' at path '${src}' could not be loaded.`); loaded++; if (loaded === total) { callback(); } }; for (let key in assetSources) { const src = assetSources[key]; if (key.includes('Sound')) { assets[key].src = src; assets[key].addEventListener('canplaythrough', () => assetLoaded(key)); assets[key].addEventListener('error', () => assetFailed(key, src)); } else { assets[key].src = src; assets[key].addEventListener('load', () => assetLoaded(key)); assets[key].addEventListener('error', () => assetFailed(key, src)); } } assets.carSound.loop = true; }
        function saveGameData() { const unlockedCarSrcs = cars.filter(c => c.unlocked).map(c => c.src); const gameData = { totalCoins: totalCoins, unlockedCars: unlockedCarSrcs }; localStorage.setItem('carGameData', JSON.stringify(gameData)); }
        function loadGameData() { const savedData = localStorage.getItem('carGameData'); if (savedData) { const gameData = JSON.parse(savedData); totalCoins = gameData.totalCoins || 0; const unlockedSrcs = gameData.unlockedCars || [cars[0].src]; cars.forEach(car => { if (unlockedSrcs.includes(car.src)) { car.unlocked = true; } }); } updateCoinDisplay(); }
        function updateCoinDisplay() { totalCoinsDisplay.innerText = totalCoins; }
        function buyCar(carIndex) { const car = cars[carIndex]; if (totalCoins >= car.price) { totalCoins -= car.price; car.unlocked = true; updateCoinDisplay(); saveGameData(); populateCarShop(); } }
        function populateCarShop() { const container = document.getElementById('carSelection'); container.innerHTML = ''; cars.forEach((car, index) => { const carDiv = document.createElement('div'); carDiv.className = 'car-option'; if (car.unlocked) { if (car.src === selectedCarSrc) carDiv.classList.add('selected'); carDiv.innerHTML = `<img src="${car.src}" alt="${car.name}"><p>${car.name}</p>`; carDiv.addEventListener('click', () => { selectedCarSrc = car.src; document.querySelectorAll('.car-option').forEach(opt => opt.classList.remove('selected')); carDiv.classList.add('selected'); shopModal.classList.add('hidden'); startGame(CONFIG.difficulty.medium); }); } else { carDiv.classList.add('locked'); carDiv.innerHTML = ` <img src="${car.src}" alt="${car.name}"> <p>${car.name}</p> <div class="price-tag"> <img src="coin.gif"> <span>${car.price}</span> </div> <button class="buy-btn" id="buyBtn-${index}">Buy</button> `; } container.appendChild(carDiv); if (!car.unlocked) { const buyButton = document.getElementById(`buyBtn-${index}`); if (totalCoins < car.price) { buyButton.disabled = true; } buyButton.addEventListener('click', () => buyCar(index)); } }); }
        function showStartScreen() { setDimensions(); resetGame(); gameState = 'menu'; playerCar.element.classList.add('hidden'); startScreen.classList.remove('hidden'); coinDisplay.classList.remove('hidden'); shopModal.classList.add('hidden'); settingsModal.classList.add('hidden'); leftButton.classList.add('hidden'); rightButton.classList.add('hidden'); assets.openingSound.currentTime = 0; assets.openingSound.play(); }
        function resetGame() { score = 0; document.getElementById('popupContainer').innerHTML = ''; document.getElementById('gameObjectContainer').innerHTML = ''; playerCar.element = document.createElement('img'); playerCar.element.id = 'playerCarElement'; playerCar.element.className = 'game-object'; playerCar.element.src = selectedCarSrc; playerCar.element.style.width = `${D_DIMS.playerCarWidth}px`; playerCar.element.style.height = `${D_DIMS.playerCarHeight}px`; document.getElementById('gameObjectContainer').appendChild(playerCar.element); playerCar.y = canvas.height - D_DIMS.playerCarHeight - (canvas.height * 0.1); playerCar.x = (canvas.width / 2) - (D_DIMS.playerCarWidth / 2); playerCar.element.style.left = `${playerCar.x}px`; playerCar.element.style.top = `${playerCar.y}px`; obstacles = []; coins = []; magnets = []; playerCar.magnetActive = false; magnetTimerDiv.classList.add('hidden'); road = { y1: 0, y2: -canvas.height }; }
        function setDimensions() { canvas.width = gameContainer.clientWidth; canvas.height = gameContainer.clientHeight; D_DIMS.roadLeftBoundary = canvas.width * 0.30; D_DIMS.roadRightBoundary = canvas.width * 0.70; D_DIMS.playerCarWidth = canvas.width * CONFIG.playerCarWidthPercent; D_DIMS.playerCarHeight = D_DIMS.playerCarWidth * 2; D_DIMS.playerCarSpeed = canvas.width * CONFIG.playerSpeedMultiplier * difficultyMultiplier; D_DIMS.baseSpeed = canvas.height * CONFIG.roadSpeedMultiplier * difficultyMultiplier; D_DIMS.obstacleWidth = D_DIMS.playerCarWidth * CONFIG.obstacleWidthFactor; D_DIMS.obstacleHeight = D_DIMS.playerCarHeight * CONFIG.obstacleWidthFactor; D_DIMS.coinSize = canvas.width * CONFIG.coinSizePercent; D_DIMS.magnetSize = canvas.width * CONFIG.magnetSizePercent; }
        function startGame(difficulty) { difficultyMultiplier = difficulty; setDimensions(); assets.openingSound.pause(); startScreen.classList.add('hidden'); leftButton.classList.remove('hidden'); rightButton.classList.remove('hidden'); gameState = 'playing'; resetGame(); playerCar.element.classList.remove('hidden'); assets.carSound.currentTime = 0; assets.carSound.play(); }
        function draw() { ctx.clearRect(0, 0, canvas.width, canvas.height); ctx.drawImage(assets.road, 0, road.y1, canvas.width, canvas.height); ctx.drawImage(assets.road, 0, road.y2, canvas.width, canvas.height); if (gameState !== 'menu') draw3DScoreBox(score); if (gameState === 'gameOver') drawGameOver(); }
        function gameLoop() { update(); draw(); requestAnimationFrame(gameLoop); }
        function createGameObject(type, src, width, height, speed) { const element = document.createElement('img'); element.src = src; element.className = `game-object ${type}`; element.style.width = `${width}px`; element.style.height = `${height}px`; const randomX = Math.random() * (D_DIMS.roadRightBoundary - D_DIMS.roadLeftBoundary - width) + D_DIMS.roadLeftBoundary; element.style.left = `${randomX}px`; element.style.top = `-${height}px`; document.getElementById('gameObjectContainer').appendChild(element); return { element, x: randomX, y: -height, width, height, speed }; }
        function checkCollision(obj1, obj2) { const rect1 = obj1.element.getBoundingClientRect(); const rect2 = obj2.element.getBoundingClientRect(); return !(rect1.right < rect2.left || rect1.left > rect2.right || rect1.bottom < rect2.top || rect1.top > rect2.bottom); }
        function createScorePopup(x, y) { const popup = document.createElement('div'); popup.innerText = '+1'; popup.className = 'score-popup'; popup.style.cssText = `left:${x}px; top:${y}px; position:absolute; color:#FFD700; font-size:24px; font-weight:bold; text-shadow:1px 1px 2px black; animation:popup-animation 1s ease-out forwards;`; document.getElementById('popupContainer').appendChild(popup); setTimeout(() => popup.remove(), 1000); }
        function draw3DScoreBox(score) { const boxWidth = 150, boxHeight = 50, x = 10, y = 10; ctx.fillStyle = 'rgba(0,0,0,0.7)'; ctx.fillRect(x, y, boxWidth, boxHeight); ctx.fillStyle = 'white'; ctx.font = 'bold 24px Arial'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText('Score: ' + score, x + boxWidth / 2, y + boxHeight / 2); }
        function drawGameOver() { ctx.fillStyle = 'rgba(0,0,0,0.6)'; ctx.fillRect(0,0,canvas.width,canvas.height); ctx.fillStyle='white'; ctx.font=`bold ${canvas.width*0.1}px Arial`; ctx.textAlign='center'; ctx.fillText('GAME OVER', canvas.width/2, canvas.height/2); }
        function loadSettings() { const savedOpacity = localStorage.getItem('controlOpacity') || '40'; document.getElementById('opacitySlider').value = savedOpacity; const opacityValue = savedOpacity / 100; leftButton.style.backgroundColor = `rgba(0, 0, 0, ${opacityValue})`; rightButton.style.backgroundColor = `rgba(0, 0, 0, ${opacityValue})`; const leftPos = JSON.parse(localStorage.getItem('leftButtonPos')); const rightPos = JSON.parse(localStorage.getItem('rightButtonPos')); if (leftPos) { leftButton.style.top = leftPos.top; leftButton.style.left = leftPos.left; } if (rightPos) { rightButton.style.top = rightPos.top; rightButton.style.left = rightPos.left; } }
        let isMovingLeft = false, isMovingRight = false; let dragTarget = null, offsetX, offsetY; function enterPositioningMode() { [leftButton, rightButton].forEach(btn => { btn.classList.add('positioning'); btn.addEventListener('mousedown', startDrag); btn.addEventListener('touchstart', startDrag); }); document.getElementById('positionControlsButton').style.display = 'none'; document.getElementById('savePositionsButton').style.display = 'block'; } function exitPositioningMode() { [leftButton, rightButton].forEach(btn => { btn.classList.remove('positioning'); btn.removeEventListener('mousedown', startDrag); btn.removeEventListener('touchstart', startDrag); }); localStorage.setItem('leftButtonPos', JSON.stringify({ top: leftButton.style.top, left: leftButton.style.left })); localStorage.setItem('rightButtonPos', JSON.stringify({ top: rightButton.style.top, left: rightButton.style.left })); document.getElementById('positionControlsButton').style.display = 'block'; document.getElementById('savePositionsButton').style.display = 'none'; } function startDrag(e) { e.preventDefault(); dragTarget = e.currentTarget; const event = e.type === 'touchstart' ? e.touches[0] : e; offsetX = event.clientX - dragTarget.offsetLeft; offsetY = event.clientY - dragTarget.offsetTop; document.addEventListener('mousemove', onDrag); document.addEventListener('touchmove', onDrag); document.addEventListener('mouseup', endDrag); document.addEventListener('touchend', endDrag); } function onDrag(e) { if (!dragTarget) return; e.preventDefault(); const event = e.type === 'touchmove' ? e.touches[0] : e; let newLeft = event.clientX - offsetX; let newTop = event.clientY - offsetY; newLeft = Math.max(0, Math.min(newLeft, canvas.width - dragTarget.offsetWidth)); newTop = Math.max(0, Math.min(newTop, canvas.height - dragTarget.offsetHeight)); dragTarget.style.left = `${newLeft}px`; dragTarget.style.top = `${newTop}px`; } function endDrag() { dragTarget = null; document.removeEventListener('mousemove', onDrag); document.removeEventListener('touchmove', onDrag); document.removeEventListener('mouseup', endDrag); document.removeEventListener('touchend', endDrag); }
        
        loadAssets(init);
    </script>
</body>
</html>

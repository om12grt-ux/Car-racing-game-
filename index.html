<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Car Racing Game</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #111; overflow: hidden; font-family: 'Arial', sans-serif; }
        #gameContainer { position: relative; width: 100vw; height: 100vh; -webkit-tap-highlight-color: transparent; overflow: hidden; }
        canvas { width: 100%; height: 100%; display: block; }
        
        .control-btn {
            position: absolute;
            /* MODIFIED: Changed fixed pixels to relative units (vmin, vh, vw) for responsiveness */
            bottom: 5vh; 
            width: 15vmin; 
            height: 15vmin;
            max-width: 80px; /* Added max-width to prevent buttons from becoming too large on big screens */
            max-height: 80px;
            background-color: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.7); border-radius: 50%;
            color: white; 
            font-size: 8vmin; /* MODIFIED: Relative font size */
            font-weight: bold;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; user-select: none; z-index: 10;
        }
        .control-btn.positioning { border: 3px dashed #FFD700; animation: pulse-border 1s infinite; }
        @keyframes pulse-border { 0% { border-color: #FFD700; } 50% { border-color: #fff; } 100% { border-color: #FFD700; } }

        .control-btn:active { background-color: rgba(255, 255, 255, 0.3); }
        /* MODIFIED: Changed fixed pixels to relative vw for better spacing */
        #leftButton { left: 5vw; }
        #rightButton { right: 5vw; }
        
        #startScreen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.4); color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; }
        #startScreen h1 { font-size: 10vw; margin-bottom: 20px; text-shadow: 3px 3px 5px #000; }
        
        #difficultySelector { display: flex; flex-direction: column; gap: 20px; align-items: center; }
        .difficulty-btn {
            cursor: pointer; border: none; background-color: transparent;
            width: 250px; max-width: 60vw; height: 80px;
            background-size: contain; background-repeat: no-repeat; background-position: center;
            transition: transform 0.2s;
        }
        .difficulty-btn:active { transform: scale(0.95); }
        #easyButton { background-image: url('easy.png'); }
        #mediumButton { background-image: url('medium.png'); }
        #hardButton { background-image: url('hard.png'); }

        /* MODIFIED: Changed fixed pixels to relative units for responsiveness */
        #settingsButton { 
            position: absolute; 
            top: 2vh; 
            right: 3vw; 
            width: 12vmin; 
            height: 12vmin;
            max-width: 50px;
            max-height: 50px; 
            background: url('settings.png') no-repeat center center / 70% 70%, rgba(0,0,0,0.5); 
            border-radius: 50%; 
            border: 2px solid white; 
            z-index: 11; 
            cursor: pointer; 
        }
        
        .modal { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.85); color: white; z-index: 20; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }
        .modal h2 { font-size: 8vw; margin-bottom: 20px; }
        .modal-content { display: flex; flex-direction: column; gap: 20px; width: 80%; max-width: 400px; }
        #carSelection { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .car-option { background-color: rgba(255, 255, 255, 0.1); border: 2px solid #4CAF50; border-radius: 10px; padding: 10px; text-align: center; cursor: pointer; transition: transform 0.2s, background-color 0.2s; }
        .car-option.selected { border-color: #FFD700; background-color: rgba(76, 175, 80, 0.5); transform: scale(1.05); }
        .car-option img { width: 80px; height: auto; max-width: 100%; }
        .car-option p { margin-top: 10px; font-weight: bold; }
        /* MODIFIED: Changed fixed padding to relative units */
        .modal-button { margin-top: 10px; padding: 2vh 4vw; font-size: 4vw; color: white; border: none; border-radius: 10px; cursor: pointer; }
        #closeShopButton { background-color: #f44336; }
        #openSettingsButton { background-color: #2196F3; }
        #backToMenuButton { background-color: #f44336; }
        .settings-option { display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .settings-option label { font-size: 4vw; }
        input[type="range"] { width: 100%; }
        #positionControlsButton { background-color: #FFC107; color: black; }
        #savePositionsButton { background-color: #4CAF50; display: none; }
        
        #magnetTimer {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            background-color: rgba(0,0,0,0.6); color: white;
            /* MODIFIED: Changed fixed padding and font-size to relative units */
            padding: 1.5vh 3vw;
            border-radius: 20px; 
            font-size: 4vmin;
            font-weight: bold;
            display: flex; align-items: center; gap: 10px; z-index: 5;
        }
        #magnetTimer img { width: 30px; height: 30px; }

        .hidden { display: none !important; }
        .game-object { position: absolute; filter: drop-shadow(4px 4px 3px rgba(0,0,0,0.5)); }
        #playerCarElement { z-index: 4; }
        #permissionScreen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #000; color: white; display: flex; justify-content: center; align-items: center; z-index: 30; cursor: pointer; text-align: center;}
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <div id="gameObjectContainer"><img id="playerCarElement" class="game-object hidden"></div>
        <div id="popupContainer"></div>
        <div id="leftButton" class="control-btn hidden">◀</div>
        <div id="rightButton" class="control-btn hidden">▶</div>

        <div id="startScreen">
            <h1>Car Racing</h1>
            <div id="difficultySelector">
                <button id="easyButton" class="difficulty-btn"></button>
                <button id="mediumButton" class="difficulty-btn"></button>
                <button id="hardButton" class="difficulty-btn"></button>
            </div>
            <div id="settingsButton"></div>
        </div>
        
        <div id="shopModal" class="modal hidden">
            <div class="modal-content">
                <h2>Choose Your Car</h2>
                <div id="carSelection"></div>
                <button id="openSettingsButton" class="modal-button">Game Settings</button>
                <button id="closeShopButton" class="modal-button">Back to Menu</button>
            </div>
        </div>

        <div id="settingsModal" class="modal hidden">
            <div class="modal-content">
                <h2>Settings</h2>
                <div class="settings-option">
                    <label for="opacitySlider">Controls Opacity</label>
                    <input type="range" id="opacitySlider" min="0" max="100" value="40">
                </div>
                <button id="positionControlsButton" class="modal-button">Set Control Position</button>
                <button id="savePositionsButton" class="modal-button">Save Positions</button>
                <button id="backToMenuButton" class="modal-button">Back to Shop</button>
            </div>
        </div>

        <div id="magnetTimer" class="hidden"><img src="magnet.png"><span></span></div>
        <div id="permissionScreen"><h2>Tap to Start</h2></div>
    </div>

    <script>
        // === CONFIGURATION AREA ===
        // Yahan se aap game ki settings aaram se badal sakte hain
        const CONFIG = {
            // Player Car Settings
            playerCarWidthPercent: 0.11, // Screen width ka percentage
            playerSpeedMultiplier: 0.0216,

            // Road & Game Speed
            roadSpeedMultiplier: 0.006,
            difficulty: {
                easy: 1.0,
                medium: 1.1,
                hard: 1.21
            },

            // Obstacles
            obstacleWidthFactor: 0.75, // Player car ke size ka factor
            obstacleSpawnInterval: 120, // Frames (60 frames = 1 second)

            // Coins
            coinSizePercent: 0.15,
            coinSpawnInterval: 180,

            // Magnet Power-up
            magnetSizePercent: 0.1,
            magnetSpawnInterval: 600, // 10 seconds
            magnetDuration: 360 // 6 seconds (60fps * 6)
        };
        
        // DOM Elements
        const canvas = document.getElementById('gameCanvas'), ctx = canvas.getContext('2d');
        const gameContainer = document.getElementById('gameContainer');
        const startScreen = document.getElementById('startScreen');
        const settingsButton = document.getElementById('settingsButton');
        const shopModal = document.getElementById('shopModal'), closeShopButton = document.getElementById('closeShopButton');
        const settingsModal = document.getElementById('settingsModal'), backToMenuButton = document.getElementById('backToMenuButton');
        const magnetTimerDiv = document.getElementById('magnetTimer');
        const leftButton = document.getElementById('leftButton'), rightButton = document.getElementById('rightButton');
        const permissionScreen = document.getElementById('permissionScreen');

        // Game State
        let gameState = 'menu', score = 0, difficultyMultiplier = 1.0;
        let selectedCarSrc = 'player_car.png';

        // Car Data
        const cars = [
            { name: 'Default Racer', src: 'player_car.png' }, { name: 'Blue Thunder', src: 'player_car_2.png' },
            { name: 'Red Fury', src: 'player_car_3.png' }, { name: 'Green Ghost', src: 'player_car_4.png' },
            { name: 'Yellow Jacket', src: 'player_car_5.png' }
        ];

        // Assets and Game Objects
        let assets = { road: new Image(), hitSound: new Audio(), carSound: new Audio(), collectSound: new Audio(), openingSound: new Audio() };
        const playerCar = { element: document.getElementById('playerCarElement'), x: 0, y: 0, magnetActive: false, magnetTimer: 0 };
        let road = {}, coins = [], obstacles = [], magnets = [];
        let coinSpawnTimer = 0, obstacleSpawnTimer = 0, magnetSpawnTimer = 0;
        let D_DIMS = {}; // Dynamic Dimensions

        function setDimensions() {
            canvas.width = gameContainer.clientWidth; canvas.height = gameContainer.clientHeight;
            D_DIMS.roadLeftBoundary = canvas.width * 0.30;
            D_DIMS.roadRightBoundary = canvas.width * 0.70;
            D_DIMS.playerCarWidth = canvas.width * CONFIG.playerCarWidthPercent;
            D_DIMS.playerCarHeight = D_DIMS.playerCarWidth * 2;
            D_DIMS.playerCarSpeed = canvas.width * CONFIG.playerSpeedMultiplier * difficultyMultiplier;
            D_DIMS.baseSpeed = canvas.height * CONFIG.roadSpeedMultiplier * difficultyMultiplier;
            D_DIMS.obstacleWidth = D_DIMS.playerCarWidth * CONFIG.obstacleWidthFactor;
            D_DIMS.obstacleHeight = D_DIMS.playerCarHeight * CONFIG.obstacleWidthFactor;
            D_DIMS.coinSize = canvas.width * CONFIG.coinSizePercent;
            D_DIMS.magnetSize = canvas.width * CONFIG.magnetSizePercent;
        }

        function startGame(difficulty) {
            difficultyMultiplier = difficulty;
            setDimensions();
            assets.openingSound.pause();
            startScreen.classList.add('hidden');
            leftButton.classList.remove('hidden');
            rightButton.classList.remove('hidden');
            gameState = 'playing';
            resetGame();
            playerCar.element.classList.remove('hidden');
            assets.carSound.currentTime = 0;
            assets.carSound.play();
        }

        function update() {
            if (gameState !== 'playing') return;
            // Road scroll
            road.y1 += D_DIMS.baseSpeed; road.y2 += D_DIMS.baseSpeed;
            if (road.y1 >= canvas.height) road.y1 = road.y2 - canvas.height;
            if (road.y2 >= canvas.height) road.y2 = road.y1 - canvas.height;
            
            // Magnet Timer
            if (playerCar.magnetActive) {
                playerCar.magnetTimer--;
                magnetTimerDiv.querySelector('span').innerText = `${Math.ceil(playerCar.magnetTimer / 60)}s`;
                if (playerCar.magnetTimer <= 0) {
                    playerCar.magnetActive = false;
                    magnetTimerDiv.classList.add('hidden');
                }
            }

            // Player Movement
            if (isMovingLeft) playerCar.x -= D_DIMS.playerCarSpeed;
            if (isMovingRight) playerCar.x += D_DIMS.playerCarSpeed;
            playerCar.x = Math.max(D_DIMS.roadLeftBoundary, Math.min(playerCar.x, D_DIMS.roadRightBoundary - D_DIMS.playerCarWidth));
            playerCar.element.style.left = `${playerCar.x}px`;
            
            // Spawn Objects
            if (++obstacleSpawnTimer > CONFIG.obstacleSpawnInterval) { obstacles.push(createGameObject('obstacle-car', `obstacle${Math.floor(Math.random() * 4) + 1}.png`, D_DIMS.obstacleWidth, D_DIMS.obstacleHeight, D_DIMS.baseSpeed + Math.random() * 2)); obstacleSpawnTimer = 0; }
            if (++coinSpawnTimer > CONFIG.coinSpawnInterval) { coins.push(createGameObject('coin', 'coin.gif', D_DIMS.coinSize, D_DIMS.coinSize, D_DIMS.baseSpeed)); coinSpawnTimer = 0; }
            if (++magnetSpawnTimer > CONFIG.magnetSpawnInterval) { magnets.push(createGameObject('magnet-powerup', 'magnet.png', D_DIMS.magnetSize, D_DIMS.magnetSize, D_DIMS.baseSpeed)); magnetSpawnTimer = 0; }
            
            // Update and check collisions for all objects
            updateAndCheckObjects(coins, (coin) => { // Coin logic
                if (playerCar.magnetActive) {
                    const dx = (playerCar.x + D_DIMS.playerCarWidth / 2) - (coin.x + coin.width / 2);
                    const dy = (playerCar.y + D_DIMS.playerCarHeight / 2) - (coin.y + coin.height / 2);
                    if (Math.sqrt(dx * dx + dy * dy) < canvas.width * 0.5) {
                        coin.x += dx * 0.1; coin.y += dy * 0.1; coin.element.style.left = `${coin.x}px`;
                    }
                }
                if (checkCollision(playerCar, coin)) {
                    score += 5; assets.collectSound.currentTime = 0; assets.collectSound.play();
                    createScorePopup(coin.x, coin.y); return true; // Remove coin
                }
            });
            
            updateAndCheckObjects(obstacles, (obstacle) => { // Obstacle logic
                if (checkCollision(playerCar, obstacle)) {
                    assets.carSound.pause(); assets.hitSound.currentTime = 0; assets.hitSound.play();
                    gameState = 'gameOver'; setTimeout(showStartScreen, 2000);
                }
            });

            updateAndCheckObjects(magnets, (magnet) => { // Magnet logic
                if (checkCollision(playerCar, magnet)) {
                    playerCar.magnetActive = true; playerCar.magnetTimer = CONFIG.magnetDuration;
                    magnetTimerDiv.classList.remove('hidden'); return true; // Remove magnet
                }
            });
        }
        
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(assets.road, 0, road.y1, canvas.width, canvas.height);
            ctx.drawImage(assets.road, 0, road.y2, canvas.width, canvas.height);
            if (gameState !== 'menu') draw3DScoreBox(score);
            if (gameState === 'gameOver') drawGameOver();
        }

        // --- Helper and Init Functions ---
        let isMovingLeft = false, isMovingRight = false;
        function init() {
            // Load settings from localStorage
            loadSettings();

            // Difficulty Buttons
            document.getElementById('easyButton').addEventListener('click', () => startGame(CONFIG.difficulty.easy));
            document.getElementById('mediumButton').addEventListener('click', () => startGame(CONFIG.difficulty.medium));
            document.getElementById('hardButton').addEventListener('click', () => startGame(CONFIG.difficulty.hard));
            
            // Control Buttons Listeners
            const handleTouchStart = (e) => e.preventDefault();
            ['mousedown', 'touchstart'].forEach(evt => {
                leftButton.addEventListener(evt, (e) => { handleTouchStart(e); isMovingLeft = true; });
                rightButton.addEventListener(evt, (e) => { handleTouchStart(e); isMovingRight = true; });
            });
            ['mouseup', 'mouseleave', 'touchend'].forEach(evt => {
                leftButton.addEventListener(evt, () => isMovingLeft = false);
                rightButton.addEventListener(evt, () => isMovingRight = false);
            });

            // Modal/Screen Listeners
            permissionScreen.addEventListener('click', () => { permissionScreen.classList.add('hidden'); showStartScreen(); requestAnimationFrame(gameLoop); }, { once: true });
            settingsButton.addEventListener('click', () => { startScreen.classList.add('hidden'); shopModal.classList.remove('hidden'); });
            closeShopButton.addEventListener('click', () => { shopModal.classList.add('hidden'); startScreen.classList.remove('hidden'); });
            document.getElementById('openSettingsButton').addEventListener('click', () => { shopModal.classList.add('hidden'); settingsModal.classList.remove('hidden'); });
            backToMenuButton.addEventListener('click', () => { settingsModal.classList.add('hidden'); shopModal.classList.remove('hidden'); });
            
            // Settings Listeners
            const opacitySlider = document.getElementById('opacitySlider');
            opacitySlider.addEventListener('input', (e) => {
                const opacity = e.target.value / 100;
                leftButton.style.backgroundColor = `rgba(0, 0, 0, ${opacity})`;
                rightButton.style.backgroundColor = `rgba(0, 0, 0, ${opacity})`;
                localStorage.setItem('controlOpacity', e.target.value);
            });
            
            document.getElementById('positionControlsButton').addEventListener('click', enterPositioningMode);
            document.getElementById('savePositionsButton').addEventListener('click', exitPositioningMode);
            
            // ADDED: Resize event listener for responsiveness
            window.addEventListener('resize', showStartScreen);

            populateCarShop();
        }

        function loadSettings() {
            // Opacity
            const savedOpacity = localStorage.getItem('controlOpacity') || '40';
            document.getElementById('opacitySlider').value = savedOpacity;
            const opacityValue = savedOpacity / 100;
            leftButton.style.backgroundColor = `rgba(0, 0, 0, ${opacityValue})`;
            rightButton.style.backgroundColor = `rgba(0, 0, 0, ${opacityValue})`;
            
            // Positions
            const leftPos = JSON.parse(localStorage.getItem('leftButtonPos'));
            const rightPos = JSON.parse(localStorage.getItem('rightButtonPos'));
            if (leftPos) { leftButton.style.top = leftPos.top; leftButton.style.left = leftPos.left; }
            if (rightPos) { rightButton.style.top = rightPos.top; rightButton.style.left = rightPos.left; }
        }

        // --- Code for Draggable Buttons ---
        let dragTarget = null, offsetX, offsetY;
        function enterPositioningMode() {
            [leftButton, rightButton].forEach(btn => {
                btn.classList.add('positioning');
                btn.addEventListener('mousedown', startDrag);
                btn.addEventListener('touchstart', startDrag);
            });
            document.getElementById('positionControlsButton').style.display = 'none';
            document.getElementById('savePositionsButton').style.display = 'block';
        }
        function exitPositioningMode() {
            [leftButton, rightButton].forEach(btn => {
                btn.classList.remove('positioning');
                btn.removeEventListener('mousedown', startDrag);
                btn.removeEventListener('touchstart', startDrag);
            });
            localStorage.setItem('leftButtonPos', JSON.stringify({ top: leftButton.style.top, left: leftButton.style.left }));
            localStorage.setItem('rightButtonPos', JSON.stringify({ top: rightButton.style.top, left: rightButton.style.left }));
            document.getElementById('positionControlsButton').style.display = 'block';
            document.getElementById('savePositionsButton').style.display = 'none';
        }
        function startDrag(e) {
            e.preventDefault();
            dragTarget = e.currentTarget;
            const event = e.type === 'touchstart' ? e.touches[0] : e;
            offsetX = event.clientX - dragTarget.offsetLeft;
            offsetY = event.clientY - dragTarget.offsetTop;
            document.addEventListener('mousemove', onDrag);
            document.addEventListener('touchmove', onDrag);
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchend', endDrag);
        }
        function onDrag(e) {
            if (!dragTarget) return;
            e.preventDefault();
            const event = e.type === 'touchmove' ? e.touches[0] : e;
            let newLeft = event.clientX - offsetX;
            let newTop = event.clientY - offsetY;
            // Bound check
            newLeft = Math.max(0, Math.min(newLeft, canvas.width - dragTarget.offsetWidth));
            newTop = Math.max(0, Math.min(newTop, canvas.height - dragTarget.offsetHeight));
            dragTarget.style.left = `${newLeft}px`;
            dragTarget.style.top = `${newTop}px`;
        }
        function endDrag() {
            dragTarget = null;
            document.removeEventListener('mousemove', onDrag);
            document.removeEventListener('touchmove', onDrag);
            document.removeEventListener('mouseup', endDrag);
            document.removeEventListener('touchend', endDrag);
        }

        function populateCarShop() {
            const container = document.getElementById('carSelection'); container.innerHTML = '';
            cars.forEach(car => {
                const carDiv = document.createElement('div'); carDiv.className = 'car-option';
                if (car.src === selectedCarSrc) carDiv.classList.add('selected');
                carDiv.innerHTML = `<img src="${car.src}" alt="${car.name}"><p>${car.name}</p>`;
                carDiv.addEventListener('click', () => {
                    // --- MODIFIED: Starts game on car selection ---
                    selectedCarSrc = car.src;
                    
                    // Update visuals
                    document.querySelectorAll('.car-option').forEach(opt => opt.classList.remove('selected'));
                    carDiv.classList.add('selected');
                    
                    // Hide modal and start game with medium difficulty
                    shopModal.classList.add('hidden');
                    startGame(CONFIG.difficulty.medium); 
                    // ------------------------------------------------
                });
                container.appendChild(carDiv);
            });
        }
        function loadAssets(callback) {
            const assetSources = { road: 'road.jpg', hitSound: 'carhit.mp3', carSound: 'carsound.mp3', collectSound: 'collect.wav', openingSound: 'opening.wav' };
            let loaded = 0; const total = Object.keys(assetSources).length;
            for (let key in assetSources) {
                if (key.includes('Sound')) {
                    assets[key].src = assetSources[key];
                    assets[key].oncanplaythrough = () => { if (++loaded === total) callback(); };
                } else {
                    assets[key].src = assetSources[key];
                    assets[key].onload = () => { if (++loaded === total) callback(); };
                }
            }
            assets.carSound.loop = true;
        }
        function gameLoop() { update(); draw(); requestAnimationFrame(gameLoop); }
        function resetGame() {
            document.getElementById('popupContainer').innerHTML = '';
            document.getElementById('gameObjectContainer').innerHTML = '';
            playerCar.element = document.createElement('img'); playerCar.element.id = 'playerCarElement';
            playerCar.element.className = 'game-object'; playerCar.element.src = selectedCarSrc;
            playerCar.element.style.width = `${D_DIMS.playerCarWidth}px`; playerCar.element.style.height = `${D_DIMS.playerCarHeight}px`;
            document.getElementById('gameObjectContainer').appendChild(playerCar.element);
            
            // MODIFIED: Changed fixed pixel value (80) to a relative value for consistent positioning
            playerCar.y = canvas.height - D_DIMS.playerCarHeight - (canvas.height * 0.1); 
            playerCar.x = (canvas.width / 2) - (D_DIMS.playerCarWidth / 2);
            
            playerCar.element.style.left = `${playerCar.x}px`; playerCar.element.style.top = `${playerCar.y}px`;
            obstacles = []; coins = []; magnets = []; score = 0;
            playerCar.magnetActive = false; magnetTimerDiv.classList.add('hidden');
            road = { y1: 0, y2: -canvas.height };
        }
        function showStartScreen() { 
            setDimensions(); 
            resetGame(); 
            gameState = 'menu'; 
            playerCar.element.classList.add('hidden'); 
            startScreen.classList.remove('hidden'); 
            shopModal.classList.add('hidden'); // Ensure modals are hidden
            settingsModal.classList.add('hidden');
            leftButton.classList.add('hidden'); 
            rightButton.classList.add('hidden'); 
            assets.openingSound.currentTime = 0; 
            assets.openingSound.play(); 
        }
        function createGameObject(type, src, width, height, speed) { const element = document.createElement('img'); element.src = src; element.className = `game-object ${type}`; element.style.width = `${width}px`; element.style.height = `${height}px`; const randomX = Math.random() * (D_DIMS.roadRightBoundary - D_DIMS.roadLeftBoundary - width) + D_DIMS.roadLeftBoundary; element.style.left = `${randomX}px`; element.style.top = `-${height}px`; document.getElementById('gameObjectContainer').appendChild(element); return { element, x: randomX, y: -height, width, height, speed }; }
        function updateAndCheckObjects(arr, onCollision) { for (let i = arr.length - 1; i >= 0; i--) { const obj = arr[i]; obj.y += obj.speed || D_DIMS.baseSpeed; obj.element.style.top = `${obj.y}px`; let removed = false; if (onCollision) { removed = onCollision(obj); } if (removed || obj.y > canvas.height) { obj.element.remove(); arr.splice(i, 1); } } }
        function checkCollision(obj1, obj2) { const rect1 = obj1.element.getBoundingClientRect(); const rect2 = obj2.element.getBoundingClientRect(); return !(rect1.right < rect2.left || rect1.left > rect2.right || rect1.bottom < rect2.top || rect1.top > rect2.bottom); }
        function createScorePopup(x, y) { const popup = document.createElement('div'); popup.innerText = '+5'; popup.className = 'score-popup'; popup.style.cssText = `left:${x}px; top:${y}px; position:absolute; color:#FFD700; font-size:24px; font-weight:bold; text-shadow:1px 1px 2px black; animation:popup-animation 1s ease-out forwards;`; document.getElementById('popupContainer').appendChild(popup); setTimeout(() => popup.remove(), 1000); }
        function draw3DScoreBox(score) { const boxWidth = 150, boxHeight = 50, x = 10, y = 10; ctx.fillStyle = 'rgba(0,0,0,0.7)'; ctx.fillRect(x, y, boxWidth, boxHeight); ctx.fillStyle = 'white'; ctx.font = 'bold 24px Arial'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText('Score: ' + score, x + boxWidth / 2, y + boxHeight / 2); }
        function drawGameOver() { ctx.fillStyle = 'rgba(0,0,0,0.6)'; ctx.fillRect(0,0,canvas.width,canvas.height); ctx.fillStyle='white'; ctx.font=`bold ${canvas.width*0.1}px Arial`; ctx.textAlign='center'; ctx.fillText('GAME OVER', canvas.width/2, canvas.height/2); }
        
        loadAssets(init);
    </script>
</body>
</html>
